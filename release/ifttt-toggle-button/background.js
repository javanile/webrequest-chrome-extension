var domainRegExp,onlyHostnameGlobal,customUrlGlobal,domainGlobal,modeGlobal,ModeEnum={TAB_CURRENT:0,TAB_NEW:1,WINDOW:2,POPUP_WINDOW:3,POPUP_BUTTON:4,NOTIFICATION_FEEDBACK:5},notificationGlobal={id:"supermegacoolid",show:"",title:"",text:"",icon:""};function initOptions(){"use strict";var o={};o.customUrl=DEFAULT_URL,o.mode=DEFAULT_MODE,o.domain=".*",o.onlyHostname=!1,o.notification={show:!1,title:"Curtom Button",text:"URL doesn't match"};for(var t=0;t<ICON_MAX_KEYS;t++)o["icon"+t]="";o.icon0="images/default-64.png",chrome.storage.sync.get(o,dataRetrieved)}function dataRetrieved(o){if(void 0===chrome.runtime.lastError){customUrlGlobal=o.customUrl,domainGlobal=o.domain,domainRegExp=new RegExp(domainGlobal),onlyHostnameGlobal=o.onlyHostname,modeGlobal=o.mode,notificationGlobal.show=o.notification.show,notificationGlobal.title=o.notification.title,notificationGlobal.text=o.notification.text;for(var t="",i=0;i<ICON_MAX_KEYS;i++)t+=o["icon"+i];notificationGlobal.icon=t,chrome.browserAction.setIcon({path:t}),modeGlobal===ModeEnum.POPUP_BUTTON?chrome.browserAction.setPopup({popup:"popup.html"}):chrome.browserAction.setPopup({popup:""})}else console.log("An error ocurred initializing options: "+chrome.runtime.lastError.string)}function prepareUrl(o){var t;return!0===onlyHostnameGlobal&&(o=(t=new URL(o)).protocol+"//"+t.hostname),customUrlGlobal.replace("%url",o)}function checkDomain(o){return domainRegExp.test(o)}function showNotification(){var o;!0===notificationGlobal.show&&(o={type:"basic",title:notificationGlobal.title,message:notificationGlobal.text,iconUrl:notificationGlobal.icon},chrome.notifications.clear(notificationGlobal.id,function(){chrome.notifications.create(notificationGlobal.id,o,function(){})}))}chrome.browserAction.onClicked.addListener(function(o){"use strict";console.log("CLICK",modeGlobal,o.url);o=o.url;if(void 0!==o&&checkDomain(o)){var t=prepareUrl(o);switch(modeGlobal){case ModeEnum.TAB_CURRENT:chrome.tabs.update({url:t});break;case ModeEnum.TAB_NEW:chrome.tabs.create({url:t});break;case ModeEnum.WINDOW:chrome.windows.create({url:t,type:"normal"});break;case ModeEnum.POPUP_WINDOW:chrome.windows.create({url:t,type:"popup"});break;case ModeEnum.NOTIFICATION_FEEDBACK:console.log("CALL",t),fetch(t).then(o=>o.text()).then(o=>{console.log("RES",o);var t={type:"basic",title:"Hello!",message:"Hello!",iconUrl:notificationGlobal.icon};chrome.notifications.clear(notificationGlobal.id,function(){chrome.notifications.create(notificationGlobal.id,t,function(){})})})}}else showNotification()}),chrome.storage.onChanged.addListener(function(o,t){"use strict";var i,n,e,a="";for(i in o)o.hasOwnProperty(i)&&(e=(n=o[i]).newValue,"customUrl"===i?customUrlGlobal=e:"mode"===i?(e!==ModeEnum.POPUP_BUTTON?chrome.browserAction.setPopup({popup:""}):chrome.browserAction.setPopup({popup:"popup.html"}),modeGlobal=e):"notification"===i?(notificationGlobal.show=e.show,notificationGlobal.title=e.title,notificationGlobal.text=e.text):"domain"===i?(domainGlobal=n.newValue,domainRegExp=new RegExp(domainGlobal)):"onlyHostname"===i?onlyHostnameGlobal=n.newValue:null!==i.match(/^icon[0-9]{1,2}$/)&&(a+=e));""!==a&&(notificationGlobal.icon=a,chrome.browserAction.setIcon({path:a}))}),document.addEventListener("DOMContentLoaded",initOptions);